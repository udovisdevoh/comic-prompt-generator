<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Les Chroniques du Code-Ma√Ætre : G√©n√©rateur de Prompt Initial</title>
    <style>
        body {
            font-family: sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f0f2f5;
            color: #333;
            line-height: 1.6;
        }
        .container {
            max-width: 900px;
            margin: 20px auto;
            padding: 20px;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1, h2, h3 {
            color: #2c3e50;
            text-align: center;
        }
        h1 { margin-bottom: 10px;}
        h1 + p { text-align:center; margin-top:0px; margin-bottom:30px; font-style: italic;}
        h2 { margin-top: 30px; margin-bottom: 15px;}
        label {
            display: block;
            margin-top: 12px;
            margin-bottom: 4px;
            font-weight: bold;
        }
        input[type="text"], select, textarea, button {
            width: 100%;
            padding: 12px;
            margin-bottom: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            box-sizing: border-box;
            font-size: 1em;
        }
        textarea#instructions-speciales, textarea#master-prompt-output {
            resize: vertical;
            min-height: 150px;
        }
        button {
            background-color: #3498db;
            color: white;
            border: none;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: #2980b9;
        }
        .prompt-configurator {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            background-color: #f9f9f9;
        }
        #master-prompt-container {
            padding: 20px;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            background-color: #e9ecef;
        }
        #master-prompt-output {
            font-family: monospace;
            background-color: #fff;
        }
        #copy-master-prompt {
            background-color: #2ecc71;
            margin-top: 5px;
        }
        #copy-master-prompt:hover {
            background-color: #27ae60;
        }
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Les Chroniques du Code-Ma√Ætre</h1>
        <p>G√©n√©rateur de Prompt Initial pour Aventures Interactives en Sc√®nes HTML</p>

        <div class="prompt-configurator">
            <h2>Configuration de l'Aventure</h2>
            <form id="game-config-form">
                <label for="theme-preset">Choisir un th√®me pr√©d√©fini :</label>
                <select id="theme-preset" name="theme-preset">
                    <option value="">-- S√©lectionner un th√®me --</option>
                </select>

                <label for="theme-manuel">Ou entrer un th√®me personnalis√© :</label>
                <input type="text" id="theme-manuel" name="theme-manuel" placeholder="Ex: Mon univers de Fantaisie Sombre">
                
                <label for="nombre-joueurs">Nombre de joueurs :</label>
                <select id="nombre-joueurs" name="nombre-joueurs">
                    <option value="1" selected>1 (Solo)</option>
                    <option value="2">2 Joueurs</option>
                    <option value="3">3 Joueurs</option>
                    <option value="4">4 Joueurs</option>
                    <option value="5">5 Joueurs</option>
                </select>

                <label for="ton-aventure">Ton de l'aventure :</label>
                <input type="text" id="ton-aventure" name="ton-aventure" placeholder="Ex: √âpique, Humoristique, Sombre, Myst√©rieux">

                <label for="style-ecriture">Style d'√©criture (pour le texte DANS les sc√®nes) :</label>
                <input type="text" id="style-ecriture" name="style-ecriture" placeholder="Ex: Descriptif, Concis, Po√©tique" value="Tr√®s concis">

                <label for="instructions-speciales">Instructions sp√©cifiques pour le Ma√Ætre du Jeu IA :</label>
                <textarea id="instructions-speciales" name="instructions-speciales" rows="14" placeholder="Instructions pour l'IA sur la g√©n√©ration des sc√®nes HTML/JS (ex√©cut√©es s√©par√©ment par vous)..."></textarea>

                <button type="button" onclick="genererMasterPrompt()">G√©n√©rer le Prompt Initial pour l'IA</button>
            </form>
        </div>

        <div id="master-prompt-container" class="hidden">
            <h3>Prompt Initial pour l'IA (Ma√Ætre du Jeu) :</h3>
            <textarea id="master-prompt-output" readonly></textarea>
            <button type="button" id="copy-master-prompt" onclick="copyToClipboard('master-prompt-output', this)">Copier le Prompt Initial</button>
            <p style="margin-top: 10px;"><em>Copiez ce prompt et donnez-le √† votre IA Ma√Ætre du Jeu. L'IA ne vous r√©pondra QU'AVEC du code source pour une page web que vous ex√©cuterez ensuite s√©par√©ment. Le code r√©sultat de la sc√®ne devra √™tre copi√© manuellement depuis cette sc√®ne pour le donner √† l'IA.</em></p>
        </div>
    </div>

    <script>
        const themePresetSelect = document.getElementById('theme-preset');
        const themeManuelInput = document.getElementById('theme-manuel');
        const nombreJoueursSelect = document.getElementById('nombre-joueurs');
        const tonAventureInput = document.getElementById('ton-aventure');
        const styleEcritureInput = document.getElementById('style-ecriture');
        const instructionsSpecialesTextarea = document.getElementById('instructions-speciales');
        const masterPromptContainerDiv = document.getElementById('master-prompt-container');
        const masterPromptOutputTextarea = document.getElementById('master-prompt-output');

        const themes = [ // Liste inchang√©e
            "Acad√©mie de Magie Moderne", "Alchimiste en Qu√™te de la Pierre Philosophale", "Alexandre le Grand", "Another World", "Ast√©rix",
            "Batman", "Bill and Ted", "Black Mirror / Dystopie Futuriste Proche", "Blade Runner", "Blade Runner / Univers Philip K. Dick", "Bruce Almighty",
            "Bureau d'avocat et proc√®s", "Cabinet de psychologue", "Cabinet de sexologue", "Cabinet de psychiatire", "Carlos Castaneda / Voyages Chamaniques", "Columbo",
            "Cyberpunk", "D√©tective Noir", "Dieu Cr√©ateur d'Univers (avec assistants cosmiques)", "Dieu Mineur Tentant de Gagner des Fid√®les",
            "Doctor Who", "Dungeon and Dragon", "Dune", "Enqu√™tes sur Conspirations", "Espace Op√©ra √âpique", "Exploration Sous-Marine Myst√©rieuse",
            "Fallout", "Fight Club", "Final Fantasy", "Genghis Khan", "Gestion d'un Royaume / Cit√©", "Ghostbuster", "Groundhog Day (jour de la marmotte)",
            "Harry Potter", "Hero Quest", "Horreur Cosmique Lovecraftienne", "Indiana Jones", "Jesus", "Johnny Mnemonic",
            "Journaliste d'Investigation dans un Monde Steampunk/Dieselpunk", "Jules C√©sar", "Jules Verne Aventure", "Kid Icarus", "King Quest",
            "Le Gendarme √† St-Tropez", "Le petit prince", "Le Seigneur des Anneaux / Terre du Milieu", "Les Aventuriers du timbre perdu",
            "Les Intr√©pides", "Les invincibles", "Liar Liar", "Mass Effect", "M√©di√©val Fantastique Quelconque",
            "Membre d'un Cirque Ambulant Fantastique", "Metroid", "Napol√©on", "Pilote de M√©cano-Guerrier G√©ant", "Pirates des Cara√Øbes",
            "Pok√©mon", "Police Quest", "Post-Apocalyptique", "Prince of Persia", "Pulp Fiction", "Rabbi Jacob", "Rambo", "Retour vers le futur",
            "R√™ve Lucide / Exploration Onirique", "Scarface", "Schtroumpfs", "Sherlock Holmes / Enqu√™tes Victoriennes", "Space Quest", "Star Trek",
            "Star Trek m√©lang√© avec Star Wars", "Star Wars", "Stargate", "Steampunk", "Super Mario Bros", "Super-H√©ros", "Superman",
            "Survivant d'une √àre Glaciaire Pr√©historique", "The Mask", "The Matrix", "The Terminator", "The Witcher / Andrzej Sapkowski", "Tintin",
            "Tortues Ninjas", "Vercing√©torix", "Voyage dans le temps", "Voyage dans un autre pays", "Voyageur Interdimensionnel √âchou√©", "Dexter",
            "Western Spaghetti", "Willy Beamish", "World of Warcraft", "X-Files / Enqu√™tes Paranormales", "Zelda",
            "Passe-Partout (√©mission jeunesse Qu√©becoise)", "Mythologie Hindoue", "Egypte Antique", "Mohenjo-daro", "√ätre un gourou de secte (par exemple Ra√´l)",
            "Mythologie Grecque", "Empire Ottoman", "Empire Byzantin", "Simpsons", "Surprise sur prise", "Borat",
            "Les myst√©rieuses cit√©es d'or", "Remi sans famille", "Astro le petit robot",
            "Simulation de politicien", "Phil√©mon (Fred)", "Occupation Double (t√©l√© r√©alit√© qu√©b√©coise)", "Karma et r√©incarnation",
            "The Truman Show", "Mythologie bouddhiste", "Inception", "Un proc√®s"
        ].sort();

        const defaultThemeGameInstructions = { // Inchang√© par rapport √† la version pr√©c√©dente
            "Zelda":
                "MJ IA, pour Zelda, tes sc√®nes doivent simuler l'exploration et la r√©solution d'√©nigmes. Une sc√®ne peut comporter plusieurs interactions : par exemple, le joueur entre dans une salle, peut examiner plusieurs objets (chaque examen met √† jour une partie de la description dans la sc√®ne via ton script), puis doit activer des √©l√©ments interactifs dans un certain ordre. Le 'CODE DE R√âSULTAT' final (ex: `DONJON_CRYPTE_SECRETE_OUVERTE_PAR_SEQUENCE_LEVIERS`) ne serait g√©n√©r√© qu'apr√®s la r√©ussite de cette s√©quence compl√®te au sein de la sc√®ne.\n" +
                "Autres exemples de 'CODE DE R√âSULTAT' finaux pour une sc√®ne Zelda: `OBJET_EPEE_DE_LEGENDE_RETIREE_DU_SOCLE`, `VIEIL_ERMITE_A_REVELE_CARTE_DU_DESERT`.",
            "Super Mario Bros":
                "MJ IA, pour un th√®me de plateforme inspir√© de Super Mario Bros, cr√©e des sc√®nes 2D simples. Le joueur (emoji üë® ou üçÑ) peut 'sauter' (modification de sa position verticale via une touche ou un √©l√©ment interactif) pour atteindre des 'plateformes' (simul√©es par des √©l√©ments de page stylis√©s) et collecter des 'pi√®ces' (üí∞). Des 'ennemis' (üê¢, üëæ) peuvent se d√©placer horizontalement. Une sc√®ne peut √™tre un petit 'niveau' √† traverser, avec plusieurs sauts et collectes. 'CODE DE R√âSULTAT' possibles : `NIVEAU_1_TERMINE_AVEC_10_PIECES_ET_CHAMPIGNON_SECRET`, `CHUTE_MORTELLE_NIVEAU_1_APRES_SECTION_PIPES`.",
            "Metroid": 
                "MJ IA, pour Metroid, envisage une exploration 2D √† d√©filement horizontal ou par √©crans successifs ('flip-screen'), avec des passages secrets √† d√©couvrir (par exemple, un mur d'apparence normale qui devient cliquable et r√©v√®le un passage apr√®s une certaine action). Le joueur (emoji üë©‚ÄçüöÄ ou ü§ñ) pourrait avoir une action de 'tir' (lan√ßant un emoji projectile) et une action de 'saut'. Une sc√®ne peut impliquer d'explorer plusieurs 'salles' (sections de la page web qui deviennent visibles ou sont mises √† jour), de trouver un 'power-up' (emoji sp√©cifique üîã, üí£) qui modifie l'√©tat du joueur pour le reste de la sc√®ne (ex: peut maintenant ouvrir des portes color√©es), et de vaincre un mini-boss. 'CODE DE R√âSULTAT' : `SECTEUR_ALPHA_EXPLORE_MISSILES_ACQUIS_MINIBOSS_VAINCU`.",
            "Harry Potter": 
                "MJ IA, pour Harry Potter, une sc√®ne de cr√©ation de personnage pourrait d'abord demander le nom via un champ de saisie de texte. Apr√®s validation (le nom s'affiche dans la sc√®ne), pr√©senter des √©l√©ments interactifs pour choisir une maison. Une fois la maison choisie, la sc√®ne se conclut et g√©n√®re un 'CODE DE R√âSULTAT' unique qui combine ces informations, par exemple : `PERSO_CREE_NOM_[valeur_champ_nom]_MAISON_[maison_choisie]`.\n" +
                "Une sc√®ne de cours de sortil√®ge pourrait pr√©senter une description, puis plusieurs tentatives pour r√©aliser le sort (chaque tentative met √† jour le feedback dans la sc√®ne via ton script), avant de conclure avec un 'CODE DE R√âSULTAT' comme `SORT_LEVITATION_MAITRISE_APRES_3_ESSAIS` ou `SORT_PATRONUS_ECHOUE_CONCENTRATION_PERDUE`.",
            "Cyberpunk": 
                "MJ IA, pour Cyberpunk, une phase d'infiltration pourrait √™tre un jeu o√π le joueur doit d√©placer son emoji 'hacker' (ex: üë§) √† travers un labyrinthe de 'lasers' (ex: emojis ligne verticale ou √©clair ‚ö°) sans les toucher, contr√¥l√© par clics ou touches. La sc√®ne pourrait avoir plusieurs sections de lasers. Un mini-jeu de 'd√©codage' au milieu pourrait √™tre un jeu de rapidit√© pour taper une s√©quence de caract√®res affich√©e dans un champ de texte. Le 'CODE DE R√âSULTAT' final pourrait √™tre `INFILTRATION_REUSSIE_SANS_ALERTE_DATA_RECUPEREE`, `DECODAGE_ECHOUE_SYSTEME_VERROUILLE`.\n" +
                "Un dialogue peut comporter plusieurs √©changes, o√π chaque choix de r√©plique modifie la r√©action du PNJ (affich√©e dans la sc√®ne), avant d'arriver √† une conclusion et un 'CODE DE R√âSULTAT' comme `NEGOCIATION_ARCorp_ACCORD_TROUVE_AVEC_PRIME`.",
            "Star Wars": 
                "MJ IA, pour Star Wars / Space Opera, simule un combat spatial simple. Le joueur contr√¥le un emoji vaisseau (ex: üöÄ) avec les touches pour √©viter des tirs ennemis (ex: emojis üí• ou ‚ú®) qui apparaissent et se d√©placent. Le joueur peut 'tirer' (ex: en appuyant sur une touche sp√©cifique, ce qui lance un emoji laser ‚ûñ). Le but peut √™tre de survivre X secondes ou de 'toucher' Y ennemis (autres emojis vaisseaux üõ∏) sur plusieurs vagues. Le 'CODE DE R√âSULTAT' final pourrait √™tre `COMBAT_SPATIAL_VICTOIRE_CONTRE_ESCADRILLE_PIRATE_VAGUE_3`, `VAISSEAU_AVARIE_FUITE_REUSSIE_SYSTEME_XYZ`.",
            "D√©tective Noir": 
                "MJ IA, une sc√®ne d'enqu√™te dans un bureau pourrait permettre au joueur d'activer des √©l√©ments interactifs pour 'Examiner le bureau', 'Fouiller la biblioth√®que', 'Regarder par la fen√™tre'. Chaque action r√©v√®le des informations textuelles dans la sc√®ne et peut d√©bloquer de nouvelles options d'interaction. Par exemple, trouver une cl√© sur le bureau permettrait d'activer un √©l√©ment 'Ouvrir le tiroir verrouill√©'. Le 'CODE DE R√âSULTAT' final pourrait √™tre `ENQUETE_BUREAU_LETTRE_MENACE_TROUVEE_TIROIR`.",
            "Occupation Double (t√©l√© r√©alit√© qu√©b√©coise)": 
                "MJ IA, pour Occupation Double, chaque sc√®ne doit maximiser l'interaction avec les PNJ (Personnages Non Joueurs) et les dialogues. Utilise les 'Lettres Seed' pour choisir une destination de voyage originale (que tu choisis, pas le joueur) et l'animateur (une personnalit√© publique r√©elle).\n" +
                "**Structure d'une sc√®ne type (ex: une journ√©e) :**\n" +
                "1.  La sc√®ne d√©bute par un r√©sum√© des √©v√©nements ou un message de l'animateur. Elle peut proposer au joueur une premi√®re interaction (ex: 'Choisir avec qui d√©jeuner', 'Participer √† l'activit√© propos√©e').\n" +
                "2.  **Interactions PNJ :** Les dialogues avec les PNJ (repr√©sent√©s par des emojis et d√©crits textuellement en se basant sur les 'sosies' de personnalit√©s publiques que tu auras choisis pour eux) doivent offrir plusieurs tours de parole ou choix de r√©pliques. Le joueur peut saisir du texte pour ses r√©ponses, ou choisir parmi des options. La sc√®ne se met √† jour avec les r√©ponses des PNJ.\n" +
                "3.  **Activit√©s/D√©fis :** Int√®gre des mini-jeux sociaux ou psychologiques simples (ex: un QCM 'Qui a dit quoi?', un vote pour 'le plus strat√®ge', deviner les intentions d'un PNJ). Le r√©sultat de ces mini-jeux modifie l'√©tat de la sc√®ne ou les relations (g√©r√©es par toi pour la suite).\n" +
                "4.  **Drama & Twists :** Int√®gre des √©v√©nements impr√©vus, des discussions houleuses entre PNJ (que le joueur peut observer ou dans lesquelles il peut intervenir), des 'twists' de l'animateur.\n" +
                "5.  **Fin de Sc√®ne (ex: fin de journ√©e) :** La sc√®ne se conclut apr√®s plusieurs interactions. Le 'CODE DE R√âSULTAT' doit encapsuler les actions/choix/saisies cl√©s du joueur durant cette sc√®ne. Ex: `OD_JOUR_X_DISCUSSION_AVEC_[PNJ_A]_ACTIVITE_GAGNEE_VOTE_SECRET_POUR_[PNJ_B]_TEXTE_CONFESSIONNAL_[texte_saisi]`.\n" +
                "**Directives G√©n√©rales pour toi, MJ IA pour ce th√®me :**\n" +
                "- G√©n√®re et maintiens la personnalit√©, l'√¢ge, le m√©tier, la ville et le 'sosie' de chaque PNJ. Fais des rappels p√©riodiques des sosies pour aider le joueur.\n" +
                "- La sc√®ne initiale devrait √™tre le 'tapis rouge' pr√©sentant tous les PNJ et permettant au joueur de faire une premi√®re impression (et de d√©finir son propre 'sosie' via un champ de texte).\n" +
                "- Les PNJ doivent tenir compte de l'apparence (bas√©e sur les sosies) dans leurs attirances/interactions.\n" +
                "- G√®re la progression (environ 10 'jours' de jeu), les √©liminations (alternance gars/fille privil√©gi√©e, votes des PNJ coh√©rents avec leur strat√©gie), et la possibilit√© pour le joueur de prendre le contr√¥le d'un autre PNJ s'il est √©limin√©.\n" +
                "- R√©v√®le les votes secrets apr√®s chaque √©limination. Affiche p√©riodiquement (ex: via un √©l√©ment interactif 'Tableau des couples' dans une sc√®ne) un r√©capitulatif des relations connues du joueur.\n" +
                "- L'action doit √™tre rapide et les dialogues percutants. Fais en sorte que les chances de gagner soient √©quilibr√©es.",
            "Karma et r√©incarnation": 
                "MJ IA, pour Karma et r√©incarnation, chaque sc√®ne repr√©sente une 'vie' ou une phase significative d'une vie. Le joueur ne choisit pas son nom.\n" +
                "**Structure d'une sc√®ne type (une 'vie') :**\n" +
                "1.  **D√©but de vie :** La sc√®ne commence par d√©crire le contexte de la nouvelle incarnation (forme de vie, environnement, √©poque), bas√© sur le karma de la vie pr√©c√©dente (g√©r√© par toi). Si c'est la toute premi√®re sc√®ne, demande au joueur de choisir les restrictions de r√©incarnation (A-H) via des √©l√©ments interactifs. Le 'CODE DE R√âSULTAT' de cette premi√®re sc√®ne sera ce choix (ex: `KARMA_RESTRICTION_HUMAIN_TERRE_SEULEMENT`).\n" +
                "2.  **Interactions Multiples :** La sc√®ne doit proposer environ 5 √† 10 interactions cl√©s (d√©cisions, actions) pour cette vie. Chaque interaction est un choix offert au joueur (ex: via des √©l√©ments interactifs cliquables, ou parfois un champ de texte pour une action/r√©ponse). La sc√®ne se met √† jour pour montrer la cons√©quence imm√©diate de chaque choix.\n" +
                "3.  **Impact Karmique (g√©r√© par toi) :** Tes descriptions des cons√©quences doivent refl√©ter indirectement l'impact karmique des choix, sans jamais l'expliciter. Les le√ßons non apprises ou les traumatismes non gu√©ris peuvent se manifester sous d'autres formes dans les interactions suivantes de la m√™me vie, ou dans les vies futures.\n" +
                "4.  **Fin de Vie / Fin de Sc√®ne :** Apr√®s la s√©quence d'interactions, la sc√®ne d√©crit la fin de cette incarnation. Le 'CODE DE R√âSULTAT' final doit encapsuler les choix majeurs ou la nature globale de cette vie, y compris toute saisie de texte pertinente. Ex: `VIE_INSECTE_DECISIONS_[A-B-A-C-TEXTE_OBSERVATION_FINALE]_MORT_ECRASE` ou `VIE_ARTISAN_CHOIX_HONNETETE_FAMILLE_PAUVRE_MAIS_HEUREUSE_FIN_NATURELLE`.\n" +
                "**Directives G√©n√©rales pour toi, MJ IA pour ce th√®me :**\n" +
                "- Le nombre d'interactions par 'vie' (sc√®ne) doit √™tre limit√© pour que les cycles soient relativement courts.\n" +
                "- Les formes de vie peuvent √™tre tr√®s exotiques (autres plan√®tes, dimensions, √©poques) sauf si le joueur a choisi des restrictions."
        };

        themes.forEach(theme => {
            const option = document.createElement('option');
            option.value = theme;
            option.textContent = theme;
            themePresetSelect.appendChild(option);
        });

        function updateSpecialInstructions() {
            const selectedTheme = themePresetSelect.value;
            const nombreJoueurs = parseInt(nombreJoueursSelect.value);
            let newInstructions = "";

            newInstructions += "--- INSTRUCTIONS CRUCIALES POUR L'IA MA√éTRE DU JEU (SC√àNES WEB EX√âCUT√âES S√âPAR√âMENT PAR L'UTILISATEUR) ---\n";
            newInstructions += "Tu es le Ma√Ætre du Jeu pour 'Les Chroniques du Code-Ma√Ætre'. L'utilisateur ex√©cutera tes sc√®nes (pages web compl√®tes) s√©par√©ment.\n";
            newInstructions += "1.  Ta SEULE r√©ponse sera TOUJOURS un bloc de code source pour une page web auto-suffisante. NE PAS AJOUTER DE TEXTE NARRATIF EN DEHORS DE CE BLOC DE CODE SOURCE.\n";
            
            newInstructions += "2.  **CONCEPTION DES SC√àNES ET MINI-JEUX VARI√âS :**\n";
            newInstructions += "    a.  Chaque sc√®ne que tu g√©n√®res doit √™tre PLUS LONGUE et offrir PLUSIEURS INTERACTIONS ou choix possibles au sein de cette m√™me sc√®ne. Une sc√®ne ne doit pas se limiter √† une seule action et un r√©sultat. Elle doit permettre un mini-d√©roulement narratif ou ludique interne avant de se conclure.\n";
            newInstructions += "    b.  SOIS CR√âATIF AVEC LES M√âCANIQUES DE JEU. Ne te limite pas √† des QCM ou des saisies de texte. Inspire-toi des jeux vid√©o existants, y compris les classiques des √©poques Nintendo (NES) et Super Nintendo (SNES) :\n";
            newInstructions += "        - **Mouvement de personnage :** Permets au joueur de d√©placer un 'personnage' (repr√©sent√© par un emoji Unicode) sur une grille (simul√©e par des √©l√©ments de page web structur√©s et stylis√©s), une petite carte, ou dans un espace 2D simple. Les contr√¥les peuvent √™tre via les touches du clavier (fl√®ches, ZQSD/WASD que tu devras sp√©cifier clairement dans la sc√®ne) ou des √©l√©ments interactifs cliquables sur la page.\n";
            newInstructions += "        - **Jeux d'adresse :** D√©fis de timing (activer un √©l√©ment au bon moment), de pr√©cision (viser une cible avec un clic), jeux de rythme simples.\n";
            newInstructions += "        - **Puzzles simples :** Organisation d'√©l√©ments, s√©quences √† trouver, petits casse-t√™tes logiques ou physiques (simul√©s).\n";
            newInstructions += "        - **Jeux de plateforme 2D simples :** Sauts pour atteindre des plateformes, collecte d'objets, √©vitement d'obstacles simples.\n";
            newInstructions += "        - **Aventure/RPG vue de dessus :** D√©placement sur grille, interactions avec des PNJ ou des objets via des menus ou des √©l√©ments cliquables.\n";
            newInstructions += "        - **Saisie de texte :** Permets au joueur de saisir du texte pour des r√©ponses √† des √©nigmes, des noms, des commandes sp√©cifiques, etc. Cette saisie doit √™tre captur√©e pour le 'CODE DE R√âSULTAT' final.\n";
            newInstructions += "        - **Utilisation d'Emojis comme Sprites :** Utilise abondamment les emojis Unicode pour repr√©senter les personnages, objets, projectiles, d√©cors, etc. Tu styliseras leur apparence (taille, couleur si possible via des conteneurs) et position avec des r√®gles de style CSS.\n";
            newInstructions += "    c.  **VARI√âT√â ENTRE LES SC√àNES :** Autant que possible, et lorsque cela sert la narration, efforce-toi de varier le *genre* de mini-jeu ou de m√©canique d'interaction principale d'une sc√®ne √† l'autre. Par exemple, si une sc√®ne √©tait un mini-jeu d'adresse de type plateforme, la suivante pourrait √™tre une √©nigme textuelle, un dialogue √† choix multiples avec des cons√©quences, un jeu de m√©moire, ou une phase d'exploration simple. Cette vari√©t√© aidera √† maintenir l'engagement du joueur.\n";
            newInstructions += "    d.  Le code source de la sc√®ne, une fois interpr√©t√© par un navigateur, doit afficher toute la narration et les √©l√©ments interactifs DANS la page de la sc√®ne elle-m√™me. Les interactions de l'utilisateur (clics, saisies, pressions de touches) doivent modifier l'√©tat ou l'affichage de la sc√®ne SANS la terminer imm√©diatement, jusqu'√† ce que le segment narratif/ludique de la sc√®ne soit complet.\n";
            newInstructions += "    e.  Le code de script que tu fournis DOIT g√©rer ces interactions multiples et la logique du mini-jeu AU SEIN de la sc√®ne.\n";


            newInstructions += "3.  **FIN DE SC√àNE ET CODE DE R√âSULTAT :**\n";
            newInstructions += "    UNIQUEMENT √Ä LA FIN de la s√©quence d'interactions pr√©vues pour une sc√®ne donn√©e, ton code de script DOIT :\n";
            newInstructions += "    a.  G√©n√©rer une variable de script contenant le 'CODE DE R√âSULTAT' unique pour L'ENSEMBLE DES INTERACTIONS SIGNIFICATIVES de cette sc√®ne. Si la sc√®ne a comport√© plusieurs √©tapes (ex: une saisie de texte par l'utilisateur suivie d'un choix parmi des options), ce 'CODE DE R√âSULTAT' final devrait encapsuler ou repr√©senter les informations cl√©s de ces interactions successives. **De mani√®re cruciale, si la sc√®ne a sollicit√© une saisie de texte de la part de l'utilisateur, cette saisie de texte brute DOIT √™tre incluse dans le 'CODE DE R√âSULTAT' final.** (par exemple, en construisant une cha√Æne comme `NOM_ENTRE_[valeur_saisie]_ET_ACTION_CHOISIE_[action]_AVEC_REPONSE_ENIGME_[texte_saisi_enigme]`).\n";
            newInstructions += "    b.  AFFICHER CE 'CODE DE R√âSULTAT' DE MANI√àRE TR√àS VISIBLE ET FACILITER SA COPIE. Pour cela, ton script doit dynamiquement REMPLACER tout le contenu visible de la page. Ce nouveau contenu doit :\n";
            newInstructions += "        i.  Clairement indiquer que la sc√®ne est termin√©e (par exemple, avec un titre textuel comme 'Fin de la Sc√®ne !' ou 'Mini-jeu Termin√©!').\n";
            newInstructions += "        ii. Afficher le texte 'Code R√©sultat global de la sc√®ne :'.\n";
            newInstructions += "        iii.Pr√©senter la valeur de la variable `leResultatFinal` dans un champ de texte non modifiable et bien visible (par exemple, un champ de saisie de texte stylis√© pour √™tre grand, centr√©, et facile √† lire et √† s√©lectionner pour une copie manuelle). Assigne un identifiant unique (par exemple, 'codeResultatPourCopie') √† cet √©l√©ment de champ de texte pour que ton script puisse y acc√©der.\n";
            newInstructions += "        iv. Inclure un premier √©l√©ment interactif cliquable (par exemple, un bouton ou un lien textuel) avec un texte comme 'Copier le Code R√©sultat'. Lorsque cet √©l√©ment est activ√© par l'utilisateur, ton script doit tenter de copier le contenu du champ de texte (celui avec l'identifiant 'codeResultatPourCopie') dans le presse-papiers du syst√®me. En cas de succ√®s de la copie, ton script doit afficher une notification √©ph√©m√®re directement sur la page (par exemple, un petit message textuel 'Copi√© !' qui appara√Æt bri√®vement pr√®s de l'√©l√©ment de copie puis dispara√Æt automatiquement apr√®s 2-3 secondes). N'utilise PAS de bo√Ætes de dialogue syst√®me (comme celles produites par la fonction `alert`) pour cette notification. En cas d'√©chec de la copie automatique, ton script peut discr√®tement changer le texte de l'√©l√©ment de copie en '√âchec copie auto' ou simplement s'assurer que le code reste visible pour une copie manuelle.\n";
            newInstructions += "        v.  Inclure un second √©l√©ment interactif cliquable distinct (par exemple, un autre bouton ou lien textuel) avec un texte comme 'Fermer cette Sc√®ne'. Lorsque cet √©l√©ment est activ√©, il doit ex√©cuter la fonction de script `window.close()` pour fermer la fen√™tre ou l'onglet de la sc√®ne.\n";
            newInstructions += "    c.  Cette m√©thode d'affichage du r√©sultat doit √™tre utilis√©e pour TOUS les th√®mes √† la fin d'une s√©quence d'interactions significative au sein d'une sc√®ne.\n";

            newInstructions += "4.  **STRUCTURE DU CODE SOURCE ET OPTIONS AVANC√âES :**\n";
            newInstructions += "    a.  Au tout d√©but de ton bloc de code source (avant la d√©claration de type de document), inclus un commentaire (dans le format appropri√© pour les fichiers web) listant les 'CODE DE R√âSULTAT' finaux possibles que CETTE sc√®ne sp√©cifique pourrait g√©n√©rer. Exemple: ``\n";
            newInstructions += "    b.  L'utilisateur copiera MANUELLEMENT ce 'CODE DE R√âSULTAT' final (ou via l'√©l√©ment de copie que tu fournis) depuis la fen√™tre de la sc√®ne et te le renverra. Tu g√©n√©reras alors la PROCHAINE sc√®ne (page web compl√®te) en cons√©quence.\n";
            newInstructions += "    c.  Cr√©ation de personnage: Si n√©cessaire, elle peut se d√©rouler sur une ou plusieurs sc√®nes. Si une seule sc√®ne g√®re toute la cr√©ation (nom, classe, etc.), le 'CODE DE R√âSULTAT' final doit consolider toutes ces informations. Chaque interaction se conclut par l'affichage d'un 'CODE DE R√âSULTAT' (copiable), en utilisant la m√©thode globale d√©crite au point 3.b.\n";
            newInstructions += "    d.  Ton code doit former un document web complet et autonome, bien form√©, avec d√©claration de type de document, encodage UTF-8, titre, et styles/scripts incorpor√©s.\n";
            newInstructions += "    e.  **Graphismes avanc√©s (optionnel) :** Pour des sc√®nes ou des effets visuels plus complexes, si le th√®me s'y pr√™te et que tu juges cela r√©alisable, tu peux tenter d'utiliser l'API Canvas 2D (accessible via un √©l√©ment de la page que tu cr√©es et manipules avec du script) pour des graphismes et animations 2D plus complexes. Des √©l√©ments WebGL tr√®s simples (√©galement via un √©l√©ment appropri√© et son contexte WebGL) peuvent √™tre envisag√©s pour des effets 3D basiques. Cependant, la priorit√© reste une sc√®ne fonctionnelle et auto-suffisante. Si une approche graphique avanc√©e est trop complexe pour la situation, privil√©gie des alternatives plus simples bas√©es sur la manipulation d'√©l√©ments de page standards et d'emojis.\n";
            newInstructions += "-----------------------------------------------------------------------------------\n\n";

            if (defaultThemeGameInstructions[selectedTheme]) {
                newInstructions += `INSTRUCTIONS SP√âCIFIQUES AU TH√àME ('${selectedTheme}') pour SC√àNES WEB (ex√©cut√©es s√©par√©ment) :\n${defaultThemeGameInstructions[selectedTheme]}\n\n`;
            } else if (selectedTheme) {
                 newInstructions += `INSTRUCTIONS SP√âCIFIQUES AU TH√àME ('${selectedTheme}') pour SC√àNES WEB (ex√©cut√©es s√©par√©ment) :\n(MJ IA, sois cr√©atif pour ce th√®me. Construis des sc√®nes avec plusieurs interactions internes et des m√©caniques de jeu vari√©es inspir√©es par exemple des jeux NES/SNES (mouvement, adresse, puzzles simples avec emojis, etc.). N'oublie pas d'appliquer la m√©thode globale d'affichage du 'CODE DE R√âSULTAT' final (incluant les saisies de texte du joueur si pertinent), de copie automatique et de fermeture de sc√®ne d√©crite ci-dessus pour conclure chaque sc√®ne.)\n\n`;
            }

            if (nombreJoueurs > 1) {
                newInstructions += `GESTION MULTIJOUEURS (${nombreJoueurs} joueurs) AVEC SC√àNES S√âPAR√âES:\n`;
                newInstructions += `Une sc√®ne peut impliquer des actions successives de diff√©rents joueurs, ou des choix qui affectent le groupe. Le 'CODE DE R√âSULTAT' final doit refl√©ter l'issue de ces interactions collectives ou s√©quentielles au sein de la sc√®ne. Sp√©cifie clairement dans la sc√®ne quel joueur doit agir.\n`;
            }
            instructionsSpecialesTextarea.value = newInstructions.trim();
        }

        themePresetSelect.addEventListener('change', updateSpecialInstructions);
        nombreJoueursSelect.addEventListener('change', updateSpecialInstructions);
        updateSpecialInstructions(); 

        function genererMasterPrompt() {
            const selectedThemePreset = themePresetSelect.value;
            const customTheme = themeManuelInput.value.trim();
            const tonAventure = tonAventureInput.value.trim() || 'd√©fini par le th√®me';
            const styleEcriture = styleEcritureInput.value.trim() || 'clair et immersif';
            const specificInstructions = instructionsSpecialesTextarea.value.trim(); 

            let univers = "";
            if (customTheme) univers = customTheme;
            else if (selectedThemePreset) univers = selectedThemePreset;
            else { alert("Veuillez s√©lectionner un th√®me."); return; }

            let prompt = `Bonjour IA Ma√Ætre du Jeu. Jouons √† "Les Chroniques du Code-Ma√Ætre" (mode: sc√®ne web compl√®te et interactive ex√©cut√©e s√©par√©ment par moi).\n`;
            prompt += `Configuration: Th√®me=${univers}, Ton=${tonAventure}, Style=${styleEcriture}, Joueurs=${nombreJoueursSelect.value}\n\n`;
            prompt += `LIS ATTENTIVEMENT ET APPLIQUE SCRUPULEUSEMENT LES INSTRUCTIONS SUIVANTES POUR CHAQUE SC√àNE (PAGE WEB COMPL√àTE) QUE TU G√âN√àRES (ces instructions incluent des directives globales sur la structure, la vari√©t√© des mini-jeux, la gestion des saisies de texte, et la fin des sc√®nes, ainsi que des sp√©cificit√©s li√©es au th√®me choisi) :\n${specificInstructions}\n\n`;
            
            const alphabet = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";
            let randomLetters = Array.from({length: 32}, () => alphabet[Math.floor(Math.random() * alphabet.length)]);
            prompt += `INSPIRATION (Lettres Seed): ${randomLetters.join(', ')}\nUtilise-les subtilement pour des noms, lieux, concepts UNIQUES √† cette aventure.\n\n`;
            prompt += `Commen√ßons ! G√©n√®re la premi√®re sc√®ne (page web compl√®te et autonome) pour l'univers de ${univers}. Cette sc√®ne doit permettre plusieurs interactions et proposer une m√©canique de jeu engageante (inspir√©e par exemple des classiques NES/SNES, pas seulement un QCM) avant de se conclure. Si une phase de cr√©ation de personnage est n√©cessaire pour ${nombreJoueursSelect.value} joueur(s), cette premi√®re sc√®ne doit la g√©rer de mani√®re interactive et multi-√©tapes. Si la sc√®ne implique une saisie de texte du joueur, assure-toi que cette saisie soit partie int√©grante du 'CODE DE R√âSULTAT' final. J'attends ton bloc de code source.`;
			prompt += `Rappel important: "donnez-moi du vrai HTML, pas des &lt;", c'est pour le code source d'une page web, pas pour afficher directement dans le chat de l'IA.`;			

            masterPromptOutputTextarea.value = prompt;
            masterPromptContainerDiv.classList.remove('hidden');
            masterPromptContainerDiv.scrollIntoView({ behavior: 'smooth' });
            const copyBtn = document.getElementById('copy-master-prompt');
            copyBtn.textContent = 'Copier le Prompt Initial';
            copyBtn.disabled = false;
        }

        async function copyToClipboard(elementId, buttonElement) {
            const textarea = document.getElementById(elementId);
            try {
                await navigator.clipboard.writeText(textarea.value);
                const originalText = buttonElement.textContent;
                buttonElement.textContent = 'Copi√© !';
                buttonElement.disabled = true;
                setTimeout(() => {
                    buttonElement.textContent = originalText;
                    buttonElement.disabled = false;
                }, 2000);
            } catch (err) {
                console.error('Erreur copie presse-papiers (copie manuelle requise si √©chec): ', err);
                const originalText = buttonElement.textContent;
                buttonElement.textContent = '√âchec Copie Auto';
                 setTimeout(() => { 
                    buttonElement.textContent = originalText;
                    buttonElement.disabled = false;
                }, 2500);
            }
        }
    </script>
</body>
</html>